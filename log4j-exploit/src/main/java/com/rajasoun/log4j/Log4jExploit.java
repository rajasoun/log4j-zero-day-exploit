package com.rajasoun.log4j;

import static spark.Spark.get;
import static spark.Spark.port;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class Log4jExploit {
    static final Logger logger = LogManager.getLogger(Log4jExploit.class.getName());

    public static void main(String[] args) {
        // System.setProperty("com.sun.jndi.ldap.object.trustURLCodebase","true");
        port(8080);
        get("/*", (req, res) -> {
            String ua = req.headers("User-Agent");
            boolean isInputMalicious = !ua.isEmpty() && ua.contains("${jndi:ldap://");
            String message = "[Code Injection Posibility: " + isInputMalicious + "]";
            // trigger on error
            logger.error(message + ua);
            return "ok: ua: " + ua + " ";
        });
    }
}
