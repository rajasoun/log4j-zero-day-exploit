package com.rajasoun.log4j;

import static spark.Spark.get;
import static spark.Spark.port;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class Log4jExploit {
    private static final String LINE = "====================================================================";
    static final Logger logger = LogManager.getLogger(Log4jExploit.class.getName());

    public static void main(String[] args) {
        // System.setProperty("com.sun.jndi.ldap.object.trustURLCodebase","true");
        port(8080);
        get("/*", (req, res) -> {
            String ua = req.headers("User-Agent");
            validateInput(ua);
            // trigger on error
            logger.error("\n" + ua);
            return "ok: ua: " + ua + "\n";
        });
    }

    private static void validateInput(String ua) {
        System.out.println("\n" + LINE);
        boolean isInputMalicious = !ua.isEmpty() && ua.contains("${jndi:ldap://");
        String message = "Code Injection Posibility: " + isInputMalicious;
        System.out.println(message);
        System.out.println(LINE + "\n");
    }
}
